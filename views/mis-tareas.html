<!-- Vista: Mis Tareas -->
<div class="container-fluid">
    <h3 class="mb-2">Mis Tareas</h3>
    <p class="text-muted mb-3">Muestra todas mis tareas pendientes o cerradas del Concentrador de Solicitudes</p>
    <hr class="mb-4">

    <!-- Alerta de error -->
    <div id="alerta-error-tareas" class="alert alert-danger d-none" role="alert">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        <span id="text-error-tareas"></span>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay d-none" id="loading-tareas">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Cargando...</span>
        </div>
    </div>

    <!-- Zona de filtros -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="btn-group" role="group">
                <button id="showHideFilterTareas" class="btn btn-secondary" type="button" data-toggle="collapse" 
                        data-target="#zona-filtro-tareas" aria-expanded="false">
                    <i class="fa fa-filter mr-2"></i>
                    <span>Mostrar filtro</span>
                </button>
                <button id="clearFilterTareas" class="btn btn-outline-dark" type="button" onclick="limpiarFiltroTareas()">
                    <i class="fas fa-broom mr-2"></i>
                    <span>Limpiar filtro</span>
                </button>
            </div>

            <!-- Panel de filtros colapsable -->
            <div class="collapse mt-3" id="zona-filtro-tareas">
                <div class="card">
                    <div class="card-body">
                        <div class="form-row">
                            <div class="col-md-3">
                                <label for="filtro-rol">Rol</label>
                                <select class="form-control" id="filtro-rol">
                                    <option value="">Todos los roles</option>
                                    <option value="administrador">Administrador</option>
                                    <option value="despachador">Despachador</option>
                                    <option value="solicitante">Solicitante</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filtro-estado-tarea">Estado</label>
                                <select class="form-control" id="filtro-estado-tarea">
                                    <option value="pendiente">Pendientes</option>
                                    <option value="todas">Todas</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filtro-instalacion-tarea">Instalaci√≥n GM</label>
                                <select class="form-control" id="filtro-instalacion-tarea">
                                    <option value="">Todas las instalaciones</option>
                                    <option value="Santiago Solar">Santiago Solar</option>
                                    <option value="Nueva Renca">Nueva Renca</option>
                                    <option value="Los Vientos">Los Vientos</option>
                                    <option value="Santa Lidia">Santa Lidia</option>
                                    <option value="CEME1">CEME1</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="text-white">Acci√≥n</label>
                                <button type="button" class="btn btn-success btn-block" onclick="filtrarTareas()">
                                    <i class="fas fa-search mr-2"></i>Filtrar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de tareas -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <table id="table-tareas" class="table table-sm table-hover table-bordered w-100">
                        <thead class="thead-light">
                            <tr>
                                <th class="text-center" style="min-width: 80px;">Acciones</th>
                                <th>ID Registro</th>
                                <th>Tarea Identificador</th>
                                <th>Tarea</th>
                                <th>Tipo Tarea</th>
                                <th>Fecha Inicial</th>
                                <th>Estado Inicial</th>
                                <th>Responsable</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se cargar√°n din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Cambiar texto del bot√≥n al colapsar/expandir
$('#zona-filtro-tareas').on('show.bs.collapse', function () {
    $('#showHideFilterTareas').html('<i class="fa fa-sort-up mr-2" aria-hidden="true"></i> Ocultar filtro');
});

$('#zona-filtro-tareas').on('hide.bs.collapse', function () {
    $('#showHideFilterTareas').html('<i class="fa fa-filter mr-2" aria-hidden="true"></i> Mostrar filtro');
});

// ============================================
// CARGAR DATOS DIN√ÅMICAMENTE
// ============================================

// Cargar datos de solicitudes si no est√°n disponibles
if (typeof solicitudesData === 'undefined') {
    console.warn('solicitudesData no est√° disponible, cargando desde archivo...');
    // En un entorno real, esto se cargar√≠a din√°micamente
    // Por ahora, asumimos que se carga desde el archivo global
}

(function() {
    console.log('üîÑ Cargando Mis Tareas...');
    
    // Obtener datos de tareas (en producci√≥n, desde SharePoint/API)
    const tareas = obtenerTareasMock();
    console.log(`üìä Encontradas ${tareas.length} tareas`);
    
    const tbody = $('#table-tareas tbody');
    tbody.empty(); // Limpiar tabla
    
    // Generar cada fila
    tareas.forEach(tarea => {
        // Determinar badge de estado
        let badgeEstado = 'badge-secondary';
        switch(tarea.ESTADO_INICIAL) {
            case 'Pendiente': badgeEstado = 'badge-warning'; break;
            case 'Por Aprobar': badgeEstado = 'badge-info'; break;
            case 'En An√°lisis': badgeEstado = 'badge-info'; break;
            case 'Devuelta': badgeEstado = 'badge-danger'; break;
            case 'Programada': badgeEstado = 'badge-success'; break;
            case 'Vigente': badgeEstado = 'badge-primary'; break;
            case 'Analizado': badgeEstado = 'badge-info'; break;
            case 'Ingresada': badgeEstado = 'badge-secondary'; break;
            case 'Completar': badgeEstado = 'badge-warning'; break;
            case 'Finalizada': badgeEstado = 'badge-secondary'; break;
        }
        
        // Formatear fecha
        const fechaFormateada = tarea.FECHA_INICIAL ? moment(tarea.FECHA_INICIAL).format('DD/MM/YYYY') : '-';
        
        // Generar HTML de acciones
        const acciones = `
            <a href="javascript:;" onclick="gestionarSolicitudTarea(${tarea.ID_REGISTRO}, '${tarea.ROL}')" class="text-danger" title="Gestionar">
                <i class="fas fa-arrow-circle-right"></i>
            </a>
            <a href="javascript:;" onclick="abrirBitacoraTarea(${tarea.ID_REGISTRO})" class="text-success ml-2" title="Bit√°cora">
                <i class="fas fa-clipboard-list"></i>
            </a>
        `;
        
        // Crear fila
        const fila = `
            <tr>
                <td class="text-center align-middle">${acciones}</td>
                <td>${tarea.ID_REGISTRO}</td>
                <td>${tarea.TAREA_IDENTIFICADOR}</td>
                <td>${tarea.TAREA}</td>
                <td>${tarea.TIPO_TRABAJO_TAREA}</td>
                <td>${fechaFormateada}</td>
                <td><span class="badge ${badgeEstado}">${tarea.ESTADO_INICIAL}</span></td>
                <td>${tarea.RESPONSABLE}</td>
            </tr>
        `;
        
        tbody.append(fila);
    });
    
    console.log(' Mis Tareas cargadas correctamente');
})();

function obtenerTareasMock() {
    // Obtener las primeras 10 solicitudes reales del sistema
    if (typeof solicitudesData === 'undefined') {
        console.warn('solicitudesData no est√° disponible, usando datos vac√≠os');
        return [];
    }
    
    // Tomar las primeras 10 solicitudes y convertirlas a formato de tareas
    const solicitudes = solicitudesData.slice(0, 10);
    
    return solicitudes.map((solicitud, index) => {
        // Determinar el rol responsable seg√∫n el estado
        let rol = 'administrador'; // Por defecto
        let tarea = 'Revisar Solicitud';
        
        switch(solicitud.ESTADO) {
            case 'Pendiente':
                rol = 'administrador';
                tarea = 'Revisar Solicitud';
                break;
            case 'Por Aprobar':
                rol = 'administrador';
                tarea = 'Aprobar Solicitud';
                break;
            case 'Devuelta':
                rol = 'solicitante';
                tarea = 'Completar Datos';
                break;
            case 'En An√°lisis':
                rol = 'administrador';
                tarea = 'Analizar Solicitud';
                break;
            case 'Administrador Gestionando':
                rol = 'administrador';
                tarea = 'Gestionar Solicitud';
                break;
            case 'Despachador Gestionando':
                rol = 'despachador';
                tarea = 'Gestionar Despacho';
                break;
            case 'Programada':
                rol = 'despachador';
                tarea = 'Validar Programaci√≥n';
                break;
            case 'Vigente':
                rol = 'despachador';
                tarea = 'Supervisar Ejecuci√≥n';
                break;
            case 'Extendida':
                rol = 'despachador';
                tarea = 'Gestionar Extensi√≥n';
                break;
            default:
                rol = 'administrador';
                tarea = 'Revisar Solicitud';
        }
        
        // Determinar tipo de tarea seg√∫n TIPO_TRABAJO
        let tipoTarea = 'Solicitud de Intervenci√≥n';
        switch(solicitud.TIPO_TRABAJO) {
            case 'SODI':
                tipoTarea = 'Solicitud SODI';
                break;
            case 'SICF':
                tipoTarea = 'Solicitud de Intervenci√≥n CEN-Facturaci√≥n';
                break;
            case 'SICN':
                tipoTarea = 'Solicitud de Intervenci√≥n CEN-No Facturaci√≥n';
                break;
            case 'SDCF':
                tipoTarea = 'Solicitud de Desconexi√≥n CEN-Facturaci√≥n';
                break;
            case 'SDCN':
                tipoTarea = 'Solicitud de Desconexi√≥n CEN-No Facturaci√≥n';
                break;
            case 'IL':
                tipoTarea = 'Solicitud de Intervenci√≥n en L√≠nea';
                break;
            case 'MM':
                tipoTarea = 'Solicitud de Migraci√≥n de Medidor';
                break;
            default:
                tipoTarea = 'Solicitud de Intervenci√≥n';
        }
        
        return {
            ID: index + 1,
            ID_REGISTRO: solicitud.ID_REGISTRO,
            TAREA_IDENTIFICADOR: solicitud.ID_SOLICITUD || `TAREA-${solicitud.ID_REGISTRO}`,
            TAREA: tarea,
            TIPO_TRABAJO_TAREA: tipoTarea,
            FECHA_INICIAL: solicitud.INICIO_PROGRAMADO || new Date().toISOString().split('T')[0],
            ESTADO_INICIAL: solicitud.ESTADO,
            RESPONSABLE: 'Demo Novakem 10',
            ROL: rol
        };
    });
}

// Funci√≥n para renderizar tareas en la tabla
function renderizarTareas(tareas) {
    const tbody = $('#table-tareas tbody');
    tbody.empty();
    
    if (tareas.length === 0) {
        tbody.append('<tr><td colspan="8" class="text-center text-muted">No se encontraron tareas</td></tr>');
        return;
    }
    
    tareas.forEach(tarea => {
        // Determinar badge de estado
        let badgeEstado = 'badge-secondary';
        switch(tarea.ESTADO_INICIAL) {
            case 'Pendiente': badgeEstado = 'badge-warning'; break;
            case 'Por Aprobar': badgeEstado = 'badge-info'; break;
            case 'En An√°lisis': badgeEstado = 'badge-info'; break;
            case 'Devuelta': badgeEstado = 'badge-danger'; break;
            case 'Programada': badgeEstado = 'badge-success'; break;
            case 'Vigente': badgeEstado = 'badge-primary'; break;
            case 'Analizado': badgeEstado = 'badge-info'; break;
            case 'Ingresada': badgeEstado = 'badge-secondary'; break;
            case 'Completar': badgeEstado = 'badge-warning'; break;
            case 'Finalizada': badgeEstado = 'badge-secondary'; break;
        }
        
        // Formatear fecha
        const fechaFormateada = tarea.FECHA_INICIAL ? moment(tarea.FECHA_INICIAL).format('DD/MM/YYYY') : '-';
        
        // Generar HTML de acciones
        const acciones = `
            <a href="javascript:;" onclick="gestionarSolicitudTarea(${tarea.ID_REGISTRO}, '${tarea.ROL}')" class="text-danger" title="Gestionar">
                <i class="fas fa-arrow-circle-right"></i>
            </a>
            <a href="javascript:;" onclick="abrirBitacoraTarea(${tarea.ID_REGISTRO})" class="text-success ml-2" title="Bit√°cora">
                <i class="fas fa-clipboard-list"></i>
            </a>
        `;
        
        // Crear fila
        const fila = `
            <tr>
                <td class="text-center align-middle">${acciones}</td>
                <td>${tarea.ID_REGISTRO}</td>
                <td>${tarea.TAREA_IDENTIFICADOR}</td>
                <td>${tarea.TAREA}</td>
                <td>${tarea.TIPO_TRABAJO_TAREA}</td>
                <td>${fechaFormateada}</td>
                <td><span class="badge ${badgeEstado}">${tarea.ESTADO_INICIAL}</span></td>
                <td>${tarea.RESPONSABLE}</td>
            </tr>
        `;
        
        tbody.append(fila);
    });
}

function filtrarTareas() {
    const rol = $("#filtro-rol").val();
    const estado = $("#filtro-estado-tarea").val();

    let tareas = obtenerTareasMock();

    // Aplicar filtros
    if (rol) {
        tareas = tareas.filter(t => t.ROL === rol);
    }
    if (estado === 'pendiente') {
        tareas = tareas.filter(t => ['Pendiente', 'Por Aprobar', 'En An√°lisis', 'Devuelta'].includes(t.ESTADO_INICIAL));
    }

    renderizarTareas(tareas);
}

function limpiarFiltroTareas() {
    $("#filtro-rol").val("");
    $("#filtro-estado-tarea").val("pendiente");
    
    // Recargar todas las tareas
    const tareas = obtenerTareasMock();
    renderizarTareas(tareas);
}

function verSolicitudTarea(id, rol) {
    console.log('Ver solicitud:', id, 'Rol:', rol);
    
    // Llamar a la funci√≥n correspondiente seg√∫n el rol
    switch(rol) {
        case 'administrador':
            if (typeof verSolicitudAdmin === 'function') {
                verSolicitudAdmin(id);
            } else {
                console.error('Funci√≥n verSolicitudAdmin no encontrada');
            }
            break;
        case 'despachador':
            if (typeof verSolicitudDesp === 'function') {
                verSolicitudDesp(id);
            } else {
                console.error('Funci√≥n verSolicitudDesp no encontrada');
            }
            break;
        case 'solicitante':
            if (typeof verSolicitudSolic === 'function') {
                verSolicitudSolic(id);
            } else {
                console.error('Funci√≥n verSolicitudSolic no encontrada');
            }
            break;
        default:
            console.error('Rol no reconocido:', rol);
    }
}

function gestionarSolicitudTarea(idRegistro, rol) {
    console.log('Gestionar solicitud:', idRegistro, 'Rol:', rol);
    
    // Verificar si la solicitud est√° en estado "Por Aprobar"
    const solicitud = solicitudesData.find(s => s.ID_REGISTRO === idRegistro);
    if (solicitud && solicitud.ESTADO === 'Por Aprobar') {
        // Usar modal espec√≠fico para aprobador
        gestionarSolicitudPorAprobar(idRegistro);
        return;
    }
    
    // Llamar a la funci√≥n correspondiente seg√∫n el rol para otros estados
    switch(rol) {
        case 'administrador':
            if (typeof gestionarSolicitudAdmin === 'function') {
                gestionarSolicitudAdmin(idRegistro);
            } else {
                console.error('Funci√≥n gestionarSolicitudAdmin no encontrada');
            }
            break;
        case 'despachador':
            if (typeof gestionarSolicitudDesp === 'function') {
                gestionarSolicitudDesp(idRegistro);
            } else {
                console.error('Funci√≥n gestionarSolicitudDesp no encontrada');
            }
            break;
        case 'solicitante':
            if (typeof gestionarSolicitudSolic === 'function') {
                gestionarSolicitudSolic(idRegistro);
            } else {
                console.error('Funci√≥n gestionarSolicitudSolic no encontrada');
            }
            break;
        default:
            console.error('Rol no reconocido:', rol);
    }
}

function abrirBitacoraTarea(idRegistro) {
    console.log('Abrir bit√°cora para ID Registro:', idRegistro);
    
    // Llamar a la funci√≥n global de bit√°cora si existe
    if (typeof abrirBitacora === 'function') {
        abrirBitacora(idRegistro);
    } else {
        console.error('Funci√≥n abrirBitacora no encontrada');
        alert('Abrir bit√°cora para registro: ' + idRegistro);
    }
}

// ============================================
// FUNCIONES PARA GESTI√ìN DE SOLICITUDES "POR APROBAR"
// ============================================

function gestionarSolicitudPorAprobar(idRegistro) {
    console.log('Gestionar solicitud Por Aprobar (Aprobador):', idRegistro);
    
    // Obtener la solicitud
    const solicitud = solicitudesData.find(s => s.ID_REGISTRO === idRegistro);
    if (!solicitud) {
        console.error('Solicitud no encontrada:', idRegistro);
        return;
    }
    
    // Limpiar cualquier modal anterior que pueda existir
    $('#modalGestionarSolicitudAprobador').remove();
    $('#modalAprobadorPorAprobar').remove(); // Limpiar modal anterior si existe
    
    // Cargar modal aprobador din√°micamente
    console.log('Cargando modal desde: modals/aprobador/gestionar-aprobador.html');
    $.get('modals/aprobador/gestionar-aprobador.html?v=' + Date.now(), function(modalHtml) {
        console.log('Modal cargado exitosamente');
        $('body').append(modalHtml);
        
        // Poblar modal con datos de la solicitud
        if (typeof poblarModalGestionarAprobador === 'function') {
            poblarModalGestionarAprobador(solicitud);
        } else {
            console.error('Funci√≥n poblarModalGestionarAprobador no encontrada');
        }
        
        // Mostrar modal
        $('#modalGestionarSolicitudAprobador').modal('show');
    }).fail(function(xhr, status, error) {
        console.error('Error al cargar modal gestionar-aprobador.html:', status, error);
        console.error('Response:', xhr.responseText);
        alert('Error al cargar el modal de aprobaci√≥n: ' + error + '\nPor favor, intente nuevamente.');
    });
}

// ============================================
// FUNCIONES DEL MODAL APROBADOR (MOVIDAS AQU√ç PARA EVITAR CONFLICTOS)
// ============================================

// Funci√≥n para poblar el modal con datos de la solicitud
window.poblarModalGestionarAprobador = function(solicitud) {
    console.log('Poblando modal gestionar aprobador:', solicitud);
    
    // Header: Estado y Observaciones
    $('#gestionarAprobObservacionesHeader').text(solicitud.OBSERVACIONES || 'Sin observaciones');
    
    // Identificaci√≥n
    $('#gestionarAprobIDSolicitud').val(solicitud.ID_SOLICITUD || '');
    $('#gestionarAprobTipo').val(solicitud.TIPO_TRABAJO || '');
    $('#gestionarAprobRelacionSODICEN').val(solicitud.RELACION_SODI_CEN || '');
    
    // Fechas Programadas
    $('#gestionarAprobInicioProgramado').val(solicitud.INICIO_PROGRAMADO ? formatDateTimeForDisplay(solicitud.INICIO_PROGRAMADO) : '');
    $('#gestionarAprobFinProgramado').val(solicitud.FIN_PROGRAMADO ? formatDateTimeForDisplay(solicitud.FIN_PROGRAMADO) : '');
    
    // Empresas Involucradas
    $('#gestionarAprobEmpresaSolicitante').val(solicitud.EMPRESA_SOLICITANTE || '');
    $('#gestionarAprobEmpresaReceptora').val(solicitud.EMPRESA_RECEPTORA || '');
    
    // Instalaci√≥n y Equipos
    $('#gestionarAprobInstalacionGM').val(solicitud.INSTALACION_GM || '');
    $('#gestionarAprobEquipos').val(solicitud.EQUIPOS || '');
    
    // Descripci√≥n del Trabajo
    $('#gestionarAprobDescripcionTrabajo').val(solicitud.DESCRIPCION_TRABAJO || '');
    
    // Riesgos y Afectaciones
    $('#gestionarAprobRiesgo').val(solicitud.RIESGO || '');
    $('#gestionarAprobAfectaciones').val(solicitud.AFECTACIONES || '');
    $('#gestionarAprobDescripcionRiesgo').val(solicitud.DESCRIPCION_RIESGO || '');
    $('#gestionarAprobDescripcionAfectacion').val(solicitud.DESCRIPCION_AFECTACION || '');
    
    // Archivo Adjunto
    if (solicitud.ADJUNTO && solicitud.ADJUNTO !== '-') {
        $('#gestionarAprobAdjuntoActual').text(solicitud.ADJUNTO);
        $('#gestionarAprobDescargarAdjunto').show();
    } else {
        $('#gestionarAprobAdjuntoActual').text('Sin archivo adjunto');
        $('#gestionarAprobDescargarAdjunto').hide();
    }
    
    // Metadata del Sistema
    $('#gestionarAprobIDRegistro').text(solicitud.ID_REGISTRO || '-');
    $('#gestionarAprobCreado').text(solicitud.CREADO || '-');
    $('#gestionarAprobActualizado').text(solicitud.ACTUALIZADO || '-');
    $('#gestionarAprobAdministrador').text(solicitud.ADMINISTRADOR || '-');
    $('#gestionarAprobSolicitante').text(solicitud.SOLICITANTE || '-');
    $('#gestionarAprobCreadoPor').text(solicitud.CREADO_POR || '-');
    
    // Limpiar campos de decisi√≥n
    $('input[name="aprobadorAccion"]').prop('checked', false);
    $('#aprobadorComentarios').val('');
    
    // Guardar ID para posterior uso
    $('#modalGestionarSolicitudAprobador').data('solicitudId', solicitud.ID_REGISTRO);
};

// Funci√≥n para confirmar la decisi√≥n del aprobador
window.confirmarDecisionAprobador = function() {
    const solicitudId = $('#modalGestionarSolicitudAprobador').data('solicitudId');
    const accion = $('input[name="aprobadorAccion"]:checked').val();
    const comentarios = $('#aprobadorComentarios').val().trim();
    
    // Validaciones
    if (!accion) {
        alert('Por favor seleccione una acci√≥n a realizar');
        $('#gestionarAprob-decision-tab').tab('show');
        return;
    }
    
    if (!comentarios) {
        alert('Por favor ingrese comentarios sobre la decisi√≥n.\nLos comentarios son obligatorios para justificar su decisi√≥n.');
        $('#aprobadorComentarios').focus();
        return;
    }
    
    if (comentarios.length < 10) {
        alert('Los comentarios deben tener al menos 10 caracteres para ser descriptivos.');
        $('#aprobadorComentarios').focus();
        return;
    }
    
    // Determinar nuevo estado y mensaje
    let nuevoEstado = '';
    let mensaje = '';
    let icono = '';
    
    switch(accion) {
        case 'aprobar':
            nuevoEstado = 'En An√°lisis';
            icono = '‚úÖ';
            mensaje = 'Solicitud aprobada exitosamente.\n\nLa solicitud pasa a estado "En An√°lisis" para continuar el proceso de revisi√≥n t√©cnica.';
            break;
        case 'devolver':
            nuevoEstado = 'Devuelta';
            icono = '‚Ü©Ô∏è';
            mensaje = 'Solicitud devuelta al solicitante.\n\nEl solicitante recibir√° una notificaci√≥n y podr√° realizar las correcciones necesarias seg√∫n sus comentarios.';
            break;
        case 'anular':
            nuevoEstado = 'No Solicitada';
            icono = '‚ùå';
            mensaje = 'Solicitud anulada.\n\nLa solicitud ha sido marcada como "No Solicitada" y no continuar√° el proceso.';
            break;
    }
    
    console.log('Decisi√≥n del aprobador:', {
        solicitudId,
        accion,
        nuevoEstado,
        comentarios,
        aprobador: 'Demo Novakem 10',
        fecha: new Date().toISOString()
    });
    
    // Aqu√≠ se actualizar√≠a el estado en la base de datos
    // Por ahora solo mostramos el mensaje de confirmaci√≥n
    alert(`${icono} ${mensaje}\n\nComentarios registrados:\n"${comentarios}"\n\nAprobador: Demo Novakem 10\nFecha: ${new Date().toLocaleString()}`);
    
    // Cerrar modal
    $('#modalGestionarSolicitudAprobador').modal('hide');
    
    // Recargar vista
    setTimeout(() => {
        location.reload();
    }, 1000);
};

// Funci√≥n auxiliar para formatear fechas
function formatDateTimeForDisplay(dateTimeString) {
    if (!dateTimeString) return '';
    try {
        const date = new Date(dateTimeString);
        return date.toLocaleString('es-ES', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch (error) {
        return dateTimeString;
    }
}
</script>

<style>
#table-tareas {
    font-size: 0.85rem !important;
}

#table-tareas thead th {
    background-color: #f8f9fa;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.badge {
    font-size: 0.75rem;
    padding: 0.35em 0.65em;
}
</style>
